---
import MainLayout from '../../layouts/MainLayout.astro'
import { getArticles, getArticleBySlug, formatDate } from '../../lib/api'

export async function getStaticPaths() {
  const articles = await getArticles()
  return articles.map(article => ({
    params: { slug: article.data.slug },
    props: { article }
  }))
}

const { article } = Astro.props

if (!article) {
  return Astro.redirect('/404')
}

const publishDate = article.data.published_at || article.created_at
---

<MainLayout title={`${article.data.title} - Infowall.net`} description={article.data.excerpt}>
  <!-- Breadcrumb -->
  <nav class="text-sm text-gray-500 mb-8">
    <a href="/" class="hover:text-blue-600">Home</a>
    <span class="mx-2">/</span>
    <a href="/articles" class="hover:text-blue-600">Articles</a>
    <span class="mx-2">/</span>
    <span class="text-gray-900">{article.data.title}</span>
  </nav>

  <article class="max-w-4xl mx-auto">
    <!-- Article Header -->
    <header class="mb-8">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        {article.data.title}
      </h1>
      
      <div class="flex items-center text-gray-600 mb-6">
        <span class="font-semibold">{article.data.author}</span>
        <span class="mx-2">•</span>
        <time datetime={publishDate}>{formatDate(publishDate)}</time>
      </div>

      {article.data.tags && (
        <div class="flex flex-wrap gap-2 mb-6">
          {article.data.tags.split(',').map((tag: string) => (
            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
              {tag.trim()}
            </span>
          ))}
        </div>
      )}

      {article.data.featured_image && (
        <img 
          src={article.data.featured_image} 
          alt={article.data.title}
          class="w-full rounded-lg shadow-lg mb-8"
        />
      )}
    </header>

    <!-- Article Content -->
    <div class="prose prose-lg max-w-none">
      <div set:html={article.data.content} />
    </div>

    <!-- Back Link -->
    <div class="mt-12 pt-8 border-t border-gray-200">
      <a 
        href="/articles" 
        class="inline-flex items-center text-blue-600 hover:text-blue-800 font-semibold"
      >
        ← Back to all articles
      </a>
    </div>
  </article>
</MainLayout>

